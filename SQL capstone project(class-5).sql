--STEP 1 DROP OLD TABLES IF THEY EXISTS
DROP TABLE IF EXISTS ORDERS;
DROP TABLE IF EXISTS CUSTOMER;
DROP TABLE IF EXISTS SALESMAN;
--STEP 2 CREATE SALESMAN TABLE
CREATE TABLE IF NOT EXISTS SALESMAN(
SALESMAN_ID VARCHAR(10) PRIMARY KEY,
NAME VARCHAR(50),
CITY VARCHAR(50),
COMISSION DECIMAL(4,2));
--INSERT DATA INTO SALESMAN
INSERT INTO SALESMAN (SALESMAN_ID,NAME,CITY,COMISSION) VALUES
('5001', 'James Hoog', 'New York', 0.15),
('5002', 'Nail Knite', 'Paris', 0.13),
('5005', 'Pit Alex', 'London', 0.11),
('5006', 'Mc Lyon', 'Paris', 0.14),
('5007', 'Paul Adam', 'Rome', 0.13),
('5003', 'Lauson Hen', 'San Jose', 0.12);
--STEP 3 CREATE CUSTOMER TABLE
CREATE TABLE IF NOT EXISTS CUSTOMER(
CUSTOMER_ID VARCHAR(10) PRIMARY KEY,
CUST_NAME VARCHAR(50),
CITY VARCHAR(50),
GRADE INT,
SALESMAN_ID VARCHAR(10),
FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN(SALESMAN_ID));
--INSERT DATA INTO CUSTOMER
INSERT INTO CUSTOMER (CUSTOMER_ID,CUST_NAME,CITY,GRADE,SALESMAN_ID) VALUES
('3002', 'nick rimando', 'New York', 100, '5001'),
('3007', 'brad davis', 'New York', 200, '5001'),
('3005', 'graham zusi', 'California', 200, '5002'),
('3008', 'julian green', 'London', 300, '5002'),
('3004', 'fabian johnson', 'Paris', 300, '5006'),
('3009', 'geoff cameron', 'Berlin', 100, '5003'),
('3003', 'jozy altidor', 'Moscow', 200, '5007'),
('3001', 'brad guzan', 'London', NULL, '5005');
--STEP 4 CREATE ORDERS TABLE
CREATE TABLE IF NOT EXISTS ORDERS(
ORD_NO VARCHAR(10) PRIMARY KEY,
PURCH_AMT DECIMAL(10,2),
ORD_DATE DATE,
CUSTOMER_ID VARCHAR(10),
SALESMAN_ID VARCHAR(10)),
FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID),
FOREIGN KEY (SALESMAN_ID) REFERENCES SALESMAN(SALESMAN_ID));
--INSERT DATA INTO ORDERS
INSERT INTO ORDERS(ORD_NO,PURCH_AMT,ORD_DATE,CUSTOMER_ID,SALESMAN_ID) VALUES
('70001', 150.50, '2012-10-05', '3005', '5002'),
('70009', 270.65, '2012-09-10', '3001', '5001'),
('70002', 65.26, '2012-10-05', '3002', '5003'),
('70004', 110.50, '2012-08-17', '3009', '5007'),
('70007', 948.50, '2012-09-10', '3005', '5005'),
('70005', 2400.60, '2012-07-27', '3007', '5006');
--STEP 5 QUERIES
--1: MATCHING CUSTOMERS AND SALESMAN BY CITY
SELECT C.CUST_NAME,S.NAME AS SALESMAN_NAME,S.CITY FROM CUSTOMER C 
JOIN SALESMAN S ON C.CITY=S.CITY;
--2: LINKING CUSTOMERS TO THEIR ASSIGNED SALESMAN
SELECT C.CUST_NAME,S.NAME AS SALESMAN_NAME FROM CUSTOMER C 
JOIN SALESMAN S ON C.SALESMAN_ID=S.SALESMAN_ID;
--3:ORDERS WHERE CUSTOMER AND SALESMAN ARE IN DIFFERENT CITIES
SELECT O.ORDER_NO,C.CUST_NAME,O.CUSTOMER_ID,O.SALESMAN_ID FROM ORDERS O 
JOIN CUSTOMER C ON O.CUSTOMER_ID=C.CUSTOMER_ID JOIN SALESMAN S ON O.SALESMAN_ID=S.SALESMAN_ID
WHERE C.CITY<>S.CITY;
--4:ALL ORDERS WITH CUSTOMER NAMES
SELECT O.ORDER_NO,C.CUST_NAME FROM ORDERS O 
JOIN CUSTOMER C ON O.CUSTOMER_ID=C.CUSTOMER_ID;
--5:CUSTOMERS WITH NON-NULL GRADES
SELECT C.CUST_NAMEAS CUSTOMER,C.GRADE AS GRADE FROM ORDERS O 
JOIN SALESMAN S ON O.SALESMAN_ID=S.SALESMAN_ID JOIN CUSTOMER C ON O.CUSTOMER_ID=C.CUSTOMER_ID
WHERE C.GRADE IS NOT NULL;
--6:CUSTOMERS WITH SALESMAN WHOSE COMISSION IS BETWEEN 0.12 AND 0.14
SELECT C.CUST_NAME AS CUSTOMER,C.CITY AS CITY,S.NAME AS SALESMAN,S.COMISSIONFROM CUSTOMER C 
JOIN SALESMAN S ON C.SALESMAN_ID=S.SALESMAN_ID
WHERE S.COMISSION BETWEEN 0.12 AND 0.14;
--7: CALCULATE COMMISSION FOR CUSTOMERS WITH GRADE >=200
SELECT O.ORD_NO,C.CUST_NAME,S.COMISSION AS COMMISSIONPERCENT,O.PURCH_AMT*S.COMISSION AS COMMISSION
FROM ORDERS O JOIN SALESMAN S ON O.SALESMAN_ID=S.SALESMAN_ID JOIN CUSTOMER C ON O.CUSTOMER_ID=C.CUSTOMER_ID
WHERE C.GRADE>=200;
--8:ORDERS PLACED ON A SPECIFIC DATE
SELECT * FROM CUSTOMER C JOIN ORDER O ON C.CUSTOMER_ID=O.CUSTOMER_ID
WHERE O.ORD_DATE='2012-10-05';